#!/bin/bash
awk -F'\t' 'BEGIN { QT=sprintf("%c",39); atsign=sprintf("%c",64); } { print "select " atsign "accountID := ACCOUNT_ID from PUBLISHER inner join ACCOUNT on ACCOUNT.ID = PUBLISHER.ACCOUNT_ID where COMPANY_ID = " $4 ";"; print "insert into ACCOUNT_DETAIL (TRANSACTION_TIME, ACCOUNT_ID, AMOUNT, TAX, TOTAL, DESCRIPTION, REFERENCE, TRANSACTION_TYPE) values (" QT "2014-07-10 10:00:00" QT ", " atsign "accountID, -" $2 ", 0, -" $2 ", " QT "PayPal payment" QT ", " QT QT ", " QT "FUNDS_OUT" QT ");"; print "update ACCOUNT set BALANCE = BALANCE - " $2 " where ID = " atsign "accountID;" }' < payments-completed-masspay-201407.txt
